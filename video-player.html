<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Video Player</title>
<style>
  :root{
    --bg:#141414;
    --panel:#1f1f1f;
    --text:#ffffff;
    --muted:#b3b3b3;
    --brand:#e50914;
    --brandHover:#f6121d;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial,sans-serif;
    display:flex; flex-direction:column; gap:16px;
  }

  header{
    padding:18px 20px 8px;
    display:flex; align-items:center; justify-content:space-between;
    border-bottom:1px solid #222;
  }
  .branding{display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.3px}
  .sub{color:var(--muted); font-weight:500; font-size:12px}
  .badge{background:var(--brand); padding:4px 8px; border-radius:8px; font-size:12px}

  main{padding:0 20px 20px; display:grid; gap:16px}

  .card{
    background:linear-gradient(180deg,#171717,#121212);
    border:1px solid #1d1d1d;
    border-radius:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
    overflow:hidden;
    max-width:1200px; margin:0 auto; width:100%;
  }
  .card-header{
    display:flex; align-items:center; justify-content:space-between;
    padding:12px 14px; border-bottom:1px solid #1d1d1d; background:#101010;
    gap:10px;
  }
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .pill{
    background:#0d0d0d; border:1px solid #2b2b2b; border-radius:999px; padding:6px 10px; color:#ddd; font-size:12px
  }
  .btn{
    background:var(--brand); border:none; color:white; font-weight:700;
    padding:8px 12px; border-radius:10px; cursor:pointer;
    transition:transform .06s ease, background .2s ease;
  }
  .btn:hover{ background:var(--brandHover) }
  .btn:active{ transform:scale(.98) }
  .btn.ghost{
    background:#222; color:#eee; border:1px solid #2b2b2b; font-weight:600;
  }
  input[type="file"]{display:none}

  .card-body{padding:0; position:relative}
  .player-wrap{position:relative; background:black; aspect-ratio:16/9}
  video{width:100%; height:100%; display:block; background:black}

  /* Overlay play icon */
  .big-play{
    position:absolute; inset:0; display:grid; place-items:center;
    pointer-events:none; opacity:0; transition:opacity .2s ease;
  }
  .big-play.show{opacity:.85}
  .big-play .btn{
    width:88px; height:88px; border-radius:50%; background:rgba(0,0,0,.6);
    border:3px solid rgba(255,255,255,.85);
    display:grid; place-items:center; font-size:36px; line-height:1; color:white;
    filter:drop-shadow(0 6px 18px rgba(0,0,0,.6));
  }

  /* Controls bar (Netflix-inspired) */
  .controls{
    position:absolute; left:0; right:0; bottom:0;
    background:linear-gradient(180deg,transparent,rgba(0,0,0,.75) 60%);
    padding:10px 12px 12px;
    display:flex; flex-direction:column; gap:10px;
  }
  .progress{
    width:100%; appearance:none; height:6px; background:#333; border-radius:999px; outline:none; cursor:pointer;
  }
  .progress::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none; width:14px; height:14px; border-radius:50%;
    background:var(--brand); border:none; margin-top:-4px;
  }
  .progress::-moz-range-thumb{
    width:14px; height:14px; border-radius:50%; background:var(--brand); border:none;
  }
  .bar{display:flex; align-items:center; gap:10px; justify-content:space-between}
  .left, .right{display:flex; align-items:center; gap:8px}
  .time{font-variant-numeric:tabular-nums; font-weight:600}
  .vol{width:120px}

  footer{padding:0 20px 20px; color:#8a8a8a; font-size:12px}
</style>
</head>
<body>
  <header>
    <div class="branding">
      <svg width="26" height="26" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 4h4l10 16h4L7 4H3z" fill="#e50914"/><path d="M3 20h4V4H3v16z" fill="#b20710"/></svg>
      <div>
        <div>Video Player</div>
        <div class="sub">Seleziona un file e goditi il video üé¨</div>
      </div>
    </div>
    <div class="badge">Locale</div>
  </header>

  <main>
    <section class="card">
      <div class="card-header">
        <div class="row" style="flex:1">
          <label class="btn ghost" for="file">üìÅ Scegli video</label>
          <input id="file" type="file" accept="video/*" />
          <button id="clear" class="btn ghost">‚úñÔ∏é Svuota</button>
          <span id="fileInfo" class="pill">Nessun file</span>
        </div>
        <div class="row">
          <button id="pip" class="btn ghost" title="Picture in Picture">üóó PiP</button>
          <button id="dlSubs" class="btn ghost" title="Carica sottotitoli .vtt">‚§í Sottotitoli</button>
          <input id="subs" type="file" accept=".vtt,text/vtt" style="display:none" />
        </div>
      </div>

      <div class="card-body">
        <div class="player-wrap" id="playerWrap">
          <video id="video" preload="metadata" crossorigin="anonymous">
            <!-- traccia sottotitoli opzionale -->
          </video>
          <div class="big-play" id="bigOverlay"><div class="btn">‚ñ∂</div></div>

          <!-- Controls -->
          <div class="controls">
            <input type="range" class="progress" id="progress" min="0" max="1000" value="0" step="1">
            <div class="bar">
              <div class="left">
                <button class="btn" id="playPause">‚èØ Riproduci</button>
                <button class="btn ghost" id="back10">‚è™ 10s</button>
                <button class="btn ghost" id="fwd10">‚è© 10s</button>
                <span class="time" id="time">00:00 / 00:00</span>
              </div>
              <div class="right">
                <select id="rate" class="pill" title="Velocit√†">
                  <option>0.5√ó</option><option>0.75√ó</option><option selected>1√ó</option>
                  <option>1.25√ó</option><option>1.5√ó</option><option>1.75√ó</option><option>2√ó</option>
                </select>
                <input type="range" class="vol" id="volume" min="0" max="1" step="0.01" value="1" title="Volume">
                <button class="btn ghost" id="fullscreen">‚õ∂ Fullscreen</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </section>
  </main>

  <footer>
    Scorciatoie: <code>Spazio</code> play/pausa ‚Ä¢ <code>‚Üê</code>/<code>‚Üí</code> ¬±10s ‚Ä¢ doppio click sul video per fullscreen.
  </footer>

<script>
const $ = sel => document.querySelector(sel);
const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
const fmt = s => {
  s = Math.max(0, Math.floor(s||0));
  const h = Math.floor(s/3600), m = Math.floor((s%3600)/60), sec = s%60;
  return (h? String(h).padStart(2,"0")+":" : "") + String(m).padStart(2,"0")+":"+String(sec).padStart(2,"0");
};

const video = $("#video");
const progress = $("#progress");
const timeEl = $("#time");
const playPause = $("#playPause");
const back10 = $("#back10");
const fwd10 = $("#fwd10");
const volume = $("#volume");
const rate = $("#rate");
const fullscreen = $("#fullscreen");
const bigOverlay = $("#bigOverlay");
const fileInput = $("#file");
const fileInfo = $("#fileInfo");
const clearBtn = $("#clear");
const pipBtn = $("#pip");
const subsBtn = $("#dlSubs");
const subsInput = $("#subs");
const playerWrap = $("#playerWrap");

let seekingByUser = false;

function setPausedUI(paused){
  playPause.textContent = paused ? "‚ñ∂ Riproduci" : "‚è∏ Pausa";
  bigOverlay.classList.toggle("show", paused);
}
function updateTimeUI(){
  const cur = video.currentTime || 0;
  const dur = isFinite(video.duration) ? video.duration : 0;
  timeEl.textContent = `${fmt(cur)} / ${fmt(dur||0)}`;
  if(!seekingByUser && isFinite(dur) && dur>0){
    progress.value = Math.round(cur/dur*1000);
  }
}
function loadFile(file){
  if(!file) return;
  const url = URL.createObjectURL(file);
  // Rimuovi eventuali tracce precedenti
  [...video.querySelectorAll("track")].forEach(t=>t.remove());
  video.src = url;
  video.play().catch(()=>{}); // l'autoplay potrebbe essere bloccato: va bene comunque
  fileInfo.textContent = `${file.name} (${(file.size/1048576).toFixed(2)} MB)`;
}

/* ----------- Eventi UI ----------- */
playPause.addEventListener("click", () => { if(video.paused) video.play(); else video.pause(); });
back10.addEventListener("click", () => { video.currentTime = Math.max(0, video.currentTime - 10); });
fwd10.addEventListener("click", () => { video.currentTime = Math.min(video.duration||Infinity, video.currentTime + 10); });
volume.addEventListener("input", () => video.volume = parseFloat(volume.value));
rate.addEventListener("change", () => video.playbackRate = parseFloat(rate.value));
fullscreen.addEventListener("click", () => {
  if(document.fullscreenElement) document.exitFullscreen();
  else playerWrap.requestFullscreen().catch(()=>{});
});
playerWrap.addEventListener("dblclick", ()=> fullscreen.click());

progress.addEventListener("input", () => {
  if(!isFinite(video.duration)) return;
  seekingByUser = true;
  const t = (parseInt(progress.value)/1000)*(video.duration||0);
  timeEl.textContent = `${fmt(t)} / ${fmt(video.duration||0)}`;
});
progress.addEventListener("change", () => {
  if(!isFinite(video.duration)) return;
  const t = (parseInt(progress.value)/1000)*(video.duration||0);
  video.currentTime = t;
  seekingByUser = false;
});

video.addEventListener("play", ()=> setPausedUI(false));
video.addEventListener("pause", ()=> setPausedUI(true));
video.addEventListener("timeupdate", updateTimeUI);
video.addEventListener("loadedmetadata", updateTimeUI);
video.addEventListener("volumechange", ()=>{ volume.value = video.volume; });

document.addEventListener("keydown", (e)=>{
  if(e.target && (e.target.tagName === "TEXTAREA" || e.target.tagName === "INPUT")) return;
  if(e.code === "Space"){ e.preventDefault(); playPause.click(); }
  if(e.code === "ArrowLeft"){ back10.click(); }
  if(e.code === "ArrowRight"){ fwd10.click(); }
  if(e.code === "KeyF" || e.key === "f" || e.key === "F"){
    e.preventDefault();
    if(document.fullscreenElement){
      document.exitFullscreen();
    } else{
      playerWrap.requestFullscreen().catch(()=>{});
    }
  }
});

fileInput.addEventListener("change", e => loadFile(e.target.files?.[0]) );
clearBtn.addEventListener("click", ()=>{
  video.pause();
  video.removeAttribute("src");
  video.load();
  fileInfo.textContent = "Nessun file";
  setPausedUI(true);
  updateTimeUI();
});

/* ----------- Picture-in-Picture ----------- */
pipBtn.addEventListener("click", async ()=>{
  try{
    if(document.pictureInPictureElement) await document.exitPictureInPicture();
    else await video.requestPictureInPicture();
  }catch(e){ alert("PiP non disponibile in questo browser."); }
});

/* ----------- Caricamento Sottotitoli .vtt ----------- */
subsBtn.addEventListener("click", ()=> subsInput.click());
subsInput.addEventListener("change", async (e)=>{
  const file = e.target.files?.[0];
  if(!file) return;
  const url = URL.createObjectURL(file);
  const track = document.createElement("track");
  track.kind = "subtitles";
  track.label = file.name.replace(/\.[^/.]+$/,"");
  track.srclang = "it";
  track.src = url;
  track.default = true;
  video.appendChild(track);
  // Forza caricamento traccia
  video.textTracks[0] && (video.textTracks[0].mode = "showing");
});

/* ----------- Init ----------- */
setPausedUI(true);
updateTimeUI();
setInterval(updateTimeUI, 250);
video.volume = 1;
rate.value = "1√ó";
rate.dispatchEvent(new Event("change"));
</script>
</body>
</html>
