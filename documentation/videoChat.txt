La funzionalità di video chat consente ai due utenti connessi tramite WebRTC di vedersi e parlarsi mentre guardano insieme un contenuto su Netflix. Il sistema utilizza due flussi video: uno locale, esposto nell’overlay, e uno remoto proveniente dal peer. Quando l’utente apre una pagina di Netflix, l’estensione inietta nello stesso documento un floating overlay che contiene i due riquadri video e i controlli principali. Questo overlay è indipendente dal player di Netflix e rimane visibile anche durante il fullscreen, grazie a un meccanismo di rilocazione che lo sposta automaticamente dentro l’elemento fullscreen quando necessario. Inizialmente l’overlay può essere creato e tenuto nascosto, per poi essere reso visibile quando la connessione P2P è effettivamente stabilita.

La video chat utilizza sempre un flusso locale, ma questo può essere “finto” o “reale”. Subito dopo la creazione dell’overlay, l’estensione genera un flusso audio/video fake (video nero e audio muto) e lo collega al riquadro locale, inviandolo anche alla RTCPeerConnection. Questo garantisce che la negoziazione WebRTC possa procedere anche prima che l’utente conceda i permessi. Quando la connessione P2P è pronta, la pagina può richiedere l’accesso a webcam e microfono tramite le API getUserMedia. Se l’utente concede l’autorizzazione e i dispositivi sono disponibili, le tracce reali sostituiscono quelle finte sia nel riquadro locale sia nella connessione P2P. Se invece la richiesta fallisce (permessi negati o dispositivi assenti), la chiamata continua a usare il flusso fake e i pulsanti di camera e microfono restano visivamente spenti, lasciando comunque attiva la connessione per il sync e per eventuali tentativi successivi.

Quando il peer remoto invia il proprio flusso, l’overlay aggiorna automaticamente il video remoto, lo rende udibile e cerca di riprodurlo subito; se l’autoplay viene bloccato dal browser, il sistema mostra un pulsante temporaneo che l’utente può cliccare per avviare manualmente la riproduzione del video remoto.

L’overlay contiene un insieme di pulsanti che controllano la video chat. Il pulsante della videocamera permette di attivare o disattivare il video locale: quando è spento, la traccia reale viene sostituita con il video finto (nero) e l’altro utente smette di ricevere l’immagine della webcam. Il pulsante del microfono controlla l’audio locale: quando è disattivato, le tracce audio vengono silenziate e il peer non riceve più il segnale vocale. Se l’utente prova ad attivare la camera o il microfono in assenza di dispositivi o permessi validi, il sistema mostra un messaggio di errore e il relativo pulsante rimane in stato spento. Entrambi i pulsanti aggiornano il loro colore per riflettere visivamente lo stato corrente, diventando rossi quando la funzione associata è spenta.

Il pulsante di chiusura rimuove l’intero overlay dalla pagina e, oltre a disattivare l’interfaccia, chiude anche la RTCPeerConnection lato locale, interrompendo lo scambio dei flussi audio/video con il peer. In pratica, la chiusura dell’overlay termina la chiamata per quell’utente e fa cessare la ricezione del suo stream da parte dell’altro lato. Per tornare a utilizzare la video chat è necessario ristabilire una nuova sessione P2P e reiniettare l’overlay tramite il normale flusso dell’estensione.

La finestra della video chat può essere spostata liberamente sullo schermo trascinandola con il mouse su qualsiasi punto non interattivo dell’overlay. Le sue dimensioni possono essere modificate grazie alla proprietà CSS di resize, che consente all’utente di adattarla alla propria preferenza. L’overlay gestisce automaticamente la visibilità dei controlli: normalmente resta pulito e senza elementi sovrapposti, ma quando il mouse si avvicina o l’utente tocca l’area del video, i pulsanti compaiono per qualche secondo e poi scompaiono di nuovo per non disturbare la visione.

Il pulsante di sincronizzazione, presente anch’esso nell’overlay, non fa parte della video chat in senso stretto ma condivide la stessa UI. Serve per attivare o disattivare la funzione di sync e comunica con il modulo di sincronizzazione per permettere ai due utenti di vedere lo stesso contenuto in maniera coordinata. L’indicatore posizionato accanto al pulsante mostra uno stato sintetico, indicando se il contenuto è compatibile, se i ruoli sono stati assegnati e qual è il drift istantaneo tra i due player.

La gestione dello stream remoto viene svolta dal modulo WebRTC, che crea e mantiene attiva la RTCPeerConnection, gestisce gli scambi ICE e si occupa di inoltrare lo stream remoto all’overlay. Quando un nuovo flusso remoto viene ricevuto o quando il peer cambia dispositivo audio/video, le nuove tracce vengono propagate e il video remoto viene aggiornato senza necessità di intervento manuale. In caso di disconnessioni momentanee o instabilità della connessione, la video chat rimane attiva e si ripristina automaticamente quando il flusso remoto torna disponibile, finché la connessione non viene completamente chiusa.

Nel complesso, la video chat offre un’interfaccia compatta e discreta che permette ai due utenti di comunicare in tempo reale mentre condividono la visione, con controlli essenziali ma immediati e con un comportamento che si integra naturalmente nel contesto di Netflix senza interferire con il player principale.
